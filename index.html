<html>
	<head>
		<title>GridFS</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>GridFS</h1><p>Simple GridFS capabilities built on <a href="https://github.com/christkv/node-mongodb-native" title="node-mongodb-native">node-mongodb-native</a>.</p></td><td></td></tr><tr class="filename"><td><h2 id="GridFS.js"><a href="#">GridFS</a></h2></td><td>GridFS.js</td></tr><tr class="code">
<td class="docs">
<ul><li><strong>author</strong>: <em>Siddharth</em>
Mahendraker</li><li><strong>version</strong>: <em>0</em>
.2</li></ul>
</td>
<td class="code">

</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Module dependencies.</em>
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">GridStore</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">GridStore</span>,
	<span class="class">Db</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">Db</span>,
	<span class="class">Server</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">Server</span>,
	<span class="class">Connection</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">Connection</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Creates an initialized GridFS instance.</em></p>

<ul><li><strong>class</strong>: <em>GridFS</em></li></ul>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  db</p></li><li><p><strong>param</strong>: <em>String</em>  rootcoll (optional)</p></li><li><p><strong>returns</strong>: <em>Object</em>  GridFS instance</p></li></ul>

<p>If a rootcoll is specified, files will be stored in rootcoll.files
and rootcoll.chunks. If rootcoll is not already existant, it will be created. 
If nothing is specified then the default 'fs' will be used.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="class">GridFS</span>(<span class="variable">dbname</span>,<span class="variable">filesys</span>){

	<span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;

	<span class="keyword">var</span> <span class="variable">host</span> = <span class="variable">process</span>.<span class="variable">env</span>[<span class="string">'MONGO_NODE_DRIVER_HOST'</span>] != <span class="keyword">null</span> ? <span class="variable">process</span>.<span class="variable">env</span>[<span class="string">'MONGO_NODE_DRIVER_HOST'</span>] : <span class="string">'localhost'</span>;
	<span class="keyword">var</span> <span class="variable">port</span> = <span class="variable">process</span>.<span class="variable">env</span>[<span class="string">'MONGO_NODE_DRIVER_PORT'</span>] != <span class="keyword">null</span> ? <span class="variable">process</span>.<span class="variable">env</span>[<span class="string">'MONGO_NODE_DRIVER_PORT'</span>] : <span class="class">Connection</span>.<span class="class">DEFAULT_PORT</span>;

	<span class="this">this</span>.<span class="variable">dbcon</span> = <span class="keyword">new</span> <span class="class">Db</span>(<span class="variable">dbname</span>, <span class="keyword">new</span> <span class="class">Server</span>(<span class="variable">host</span>, <span class="variable">port</span>, {}), { <span class="variable">native_parser</span> : <span class="variable">true</span> });
	<span class="this">this</span>.<span class="variable">fs</span> = <span class="variable">filesys</span> === <span class="variable">undefined</span> ? <span class="class">GridStore</span>.<span class="class">DEFAULT_ROOT_COLLECTION</span> : <span class="variable">filesys</span>;
	<span class="this">this</span>.<span class="variable">opQueue</span> = [];
	
	<span class="keyword">if</span>(!(<span class="this">this</span>.<span class="variable">dbcon</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'Database creation failed.'</span>);
	
	<span class="this">this</span>.<span class="variable">open</span>();
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Stores a file.</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Buffer</em>  buffer</p></li><li><p><strong>param</strong>: <em>String</em>  filename </p></li><li><p><strong>param</strong>: <em>String</em>  mode</p></li><li><p><strong>param</strong>: <em>Object</em>  options (optional)</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>

<p>mode can be set to either 'w' to overwrite the content of the file
or 'w+' to append to the contents of the file.</p>

<p>options can be used to specify the content<em>type, metadata and chunk</em>size</p>

<ul><li><strong>example</strong>: <em>var</em>
options = {"content_type":"image/png","metadata":{ "person": "George"},"chunk_size": 1024*4};</li></ul>

<p>The callback takes an error and a result parameter, which provides information
about the file after it has been stored. </p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">GridFS</span>.<span class="variable">prototype</span>.<span class="variable">put</span> = <span class="keyword">function</span>(<span class="variable">buffer</span>, <span class="variable">filename</span>, <span class="variable">mode</span>, <span class="variable">options</span>, <span class="variable">callback</span>){
	
	<span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
	<span class="keyword">var</span> <span class="variable">args</span> = <span class="variable">arguments</span>;

	<span class="this">this</span>.<span class="variable">opQueue</span>.<span class="variable">push</span>([<span class="variable">self</span>.<span class="variable">_put</span>,<span class="variable">args</span>]);	
	
	<span class="variable">self</span>.<span class="variable">performOp</span>();
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Gets a file.</em></p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  filename</p></li><li><p><strong>param</strong>: <em>Number</em>  length (optional)</p></li><li><p><strong>param</strong>: <em>Number</em>  offset (optional) </p></li><li><p><strong>param</strong>: <em>Object</em>  options (optional)</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>

<p>The callback function takes an error and data as parameters. The data object is 
a string.</p>

<ul><li><p><strong>see</strong>: <em>put</em>
() for options details.</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">GridFS</span>.<span class="variable">prototype</span>.<span class="variable">get</span> = <span class="keyword">function</span>(<span class="variable">filename</span>, <span class="variable">length</span>, <span class="variable">offset</span>, <span class="variable">options</span>, <span class="variable">callback</span>){

	<span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
	<span class="keyword">var</span> <span class="variable">args</span> = <span class="variable">arguments</span>;
	
	<span class="this">this</span>.<span class="variable">opQueue</span>.<span class="variable">push</span>([<span class="variable">self</span>.<span class="variable">_get</span>,<span class="variable">args</span>]);	
	
	<span class="variable">self</span>.<span class="variable">performOp</span>();
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Deletes a file.</em> </p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  filename</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>

<p>The callback function takes an error as a parameter.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">GridFS</span>.<span class="variable">prototype</span>.<span class="keyword">delete</span> = <span class="keyword">function</span>(<span class="variable">filename</span>, <span class="variable">callback</span>){

	<span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
	<span class="keyword">var</span> <span class="variable">args</span> = <span class="variable">arguments</span>;
	
	<span class="this">this</span>.<span class="variable">opQueue</span>.<span class="variable">push</span>([<span class="variable">self</span>.<span class="variable">_delete</span>,<span class="variable">args</span>]);	
	
	<span class="variable">self</span>.<span class="variable">performOp</span>();
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Opens the database connection.</em></p>

<p>This method should not normally be implemented, unless you have closed the connection
and wish to open it again.</p>

<ul><li><strong>example</strong>: <em>myFS</em>
.put(foo, bar, 'w', function(){ myFS.close(); });
			...
			myFS.open();</li></ul>

<p>By default, a GridFS instance is returned already open(). </p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">GridFS</span>.<span class="variable">prototype</span>.<span class="variable">open</span> = <span class="keyword">function</span>(){
	
	<span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
	
	<span class="this">this</span>.<span class="variable">dbcon</span>.<span class="variable">open</span>(<span class="keyword">function</span>(<span class="variable">err</span>){
		<span class="keyword">if</span>(<span class="variable">err</span>) <span class="keyword">throw</span> <span class="variable">err</span>;
		<span class="keyword">if</span>(<span class="variable">self</span>.<span class="variable">opQueue</span>.<span class="variable">length</span> &<span class="variable">gt</span>; <span class="number integer">0</span>) <span class="variable">self</span>.<span class="variable">performOp</span>();
	});
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Closes the database connection.</em></p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Function</em>  callback</li></ul>

<p>This should be called once you are done using the GridFS.
Functions called after this will throw errors. The callback is 
executed after the closing of the GridFS database connection.</p>

<ul><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">GridFS</span>.<span class="variable">prototype</span>.<span class="variable">close</span> = <span class="keyword">function</span>(<span class="variable">callback</span>){

	<span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
	<span class="keyword">var</span> <span class="variable">args</span> = <span class="variable">arguments</span>;
	
	<span class="this">this</span>.<span class="variable">opQueue</span>.<span class="variable">push</span>([<span class="variable">self</span>.<span class="variable">_close</span>,<span class="variable">args</span>]);	
	
	<span class="variable">self</span>.<span class="variable">performOp</span>();
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Exports.</em>
 </p>
</td>
<td class="code">
<pre><code><span class="variable">module</span>.<span class="variable">exports</span> = <span class="class">GridFS</span>;
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="GridStream.js"><a href="#">GridStream</a></h2></td><td>GridStream.js</td></tr><tr class="code">
<td class="docs">
<ul><li><strong>author</strong>: <em>Siddharth</em>
Mahendraker</li><li><strong>version</strong>: <em>0</em>
.1</li></ul>
</td>
<td class="code">

</td>
</tr>
<tr class="code">
<td class="docs">
<p><em>Module dependencies.</em>
 </p>
</td>
<td class="code">

</td>
</tr>
<tr class="code">
<td class="docs">
<p> Work in progress....
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">GridFS</span> = <span class="variable">require</span>(<span class="string">'./GridFS'</span>);
 
<span class="keyword">var</span> <span class="variable">util</span> = <span class="variable">require</span>(&<span class="variable">quot</span>;<span class="variable">util</span>&<span class="variable">quot</span>;),
	<span class="variable">stream</span> = <span class="variable">require</span>(<span class="string">'stream'</span>);

<span class="keyword">var</span> <span class="class">GridStore</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">GridStore</span>,
	<span class="class">Db</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">Db</span>,
	<span class="class">Server</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">Server</span>,
	<span class="class">Connection</span> = <span class="variable">require</span>(<span class="string">'mongodb'</span>).<span class="class">Connection</span>;
	
<span class="keyword">function</span> <span class="class">GridStream</span>(<span class="variable">gridFS</span>, <span class="variable">filename</span>, <span class="variable">mode</span>, <span class="variable">options</span>, <span class="variable">callback</span>){

	<span class="keyword">var</span> <span class="variable">args</span> = <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>, <span class="number integer">0</span>);
	<span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
	
	<span class="keyword">if</span>((<span class="keyword">typeof</span> <span class="variable">options</span> === <span class="string">'function'</span>) &<span class="variable">amp</span>;&<span class="variable">amp</span>; !(<span class="variable">callback</span>)){
 		<span class="variable">callback</span> = <span class="variable">args</span>.<span class="variable">pop</span>();
 		<span class="variable">options</span> = {};
 	}
 	
 	<span class="keyword">if</span>(!(<span class="variable">gridFS</span> <span class="variable">instanceof</span> <span class="class">GridFS</span>)) <span class="keyword">return</span> <span class="variable">callback</span>(<span class="keyword">new</span> <span class="class">Error</span>(<span class="string">'A GridFS object is required.'</span>),<span class="keyword">null</span>);
 	
 	<span class="this">this</span>.<span class="variable">gridFS</span> = <span class="variable">gridFS</span>;
 	<span class="this">this</span>.<span class="variable">filename</span> = <span class="variable">filename</span>;
 	<span class="this">this</span>.<span class="variable">mode</span> = <span class="variable">mode</span> === <span class="string">'r'</span> ? <span class="string">'r'</span> : <span class="variable">mode</span>;
 	<span class="this">this</span>.<span class="variable">options</span> = <span class="variable">options</span>;
 	
 	<span class="this">this</span>.<span class="variable">options</span>.<span class="variable">root</span> = <span class="this">this</span>.<span class="variable">options</span>.<span class="variable">root</span> === <span class="variable">undefined</span> ? <span class="this">this</span>.<span class="variable">gridFS</span>.<span class="variable">fs</span> : <span class="this">this</span>.<span class="variable">options</span>.<span class="variable">root</span>;
 	
 	<span class="variable">callback</span>(<span class="keyword">null</span>, <span class="this">this</span>);
};

<span class="class">GridStream</span>.<span class="variable">prototype</span>.<span class="variable">write</span> = <span class="keyword">function</span>(<span class="variable">buffer</span>){

	<span class="keyword">if</span>(!(<span class="variable">buffer</span> <span class="variable">instanceof</span> <span class="class">Buffer</span>)) <span class="variable">buffer</span> = <span class="keyword">new</span> <span class="class">Buffer</span>(<span class="variable">buffer</span>);
	<span class="this">this</span>.<span class="variable">gridFS</span>.<span class="variable">put</span>(<span class="variable">buffer</span>, <span class="this">this</span>.<span class="variable">filename</span>, <span class="string">'w+'</span>, <span class="this">this</span>.<span class="variable">options</span>, <span class="keyword">function</span>(){});
}

<span class="class">GridStream</span>.<span class="variable">prototype</span>.<span class="variable">read</span> = <span class="keyword">function</span>(){
	
}

<span class="class">GridStream</span>.<span class="variable">prototype</span>.<span class="variable">close</span> = <span class="keyword">function</span>(){
	<span class="this">this</span>.<span class="variable">gridFS</span>.<span class="variable">close</span>();
}

<span class="variable">module</span>.<span class="variable">exports</span> = <span class="class">GridStream</span>;
</code></pre>
</td>
</tr>	</body>
</html></tbody></table>